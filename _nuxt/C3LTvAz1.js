import{_ as ke}from"./DaB4Tqgg.js";import{z as F,r as m,g as se,A as w,c as a,a as t,k as C,n as oe,F as I,q as $,x as y,m as v,p as we,b as Ce,d as ne,w as Ie,B as E,l as $e,t as c,s as j,o as l,y as je}from"./D6_3hjPy.js";const Ve=F("/svg/auth.svg"),Ue=F("/svg/is_pro.svg"),ze=F("/svg/seller.svg"),Be={class:"flex h-screen bg-gray-100"},Se={class:"w-1/4 bg-white shadow-md p-4 flex flex-col"},Ae={class:"mb-4"},Me={class:"grid grid-cols-1 md:grid-cols-4 gap-3 overflow-y-auto max-h-[500px]"},Oe=["onClick"],Le=["src","alt"],We={class:"flex items-center justify-center text-sm font-medium text-center"},Ne={class:"flex items-center justify-center text-sm font-medium text-center"},Re={key:0,src:Ve,alt:"已认证",class:"w-5 h-5 inline-block ml-1"},De={key:1,src:Ue,alt:"职业选手",class:"w-5 h-5 inline-block ml-1"},Ee={key:2,src:ze,alt:"倒狗",class:"w-5 h-5 inline-block ml-1"},Fe={class:"text-xs text-gray-500 mt-1"},qe={class:"flex-1 bg-gray-50 p-6 h-full flex flex-col overflow-hidden"},Ke={class:"bg-white rounded-lg shadow p-4 mb-6"},Pe={class:"flex flex-col md:flex-row md:items-center gap-4"},Ze={class:"flex-1"},Ge={class:"flex gap-2"},He={key:0},Je={key:1,class:"flex items-center"},Qe={class:"mt-4 flex flex-wrap gap-3"},Xe=["value"],Ye=["value"],Te={key:0,class:"bg-white rounded-lg shadow p-4 mb-6 hidden md:block"},et={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},tt={class:"bg-pink-50 rounded-lg p-3 text-center"},st={class:"text-xl font-bold"},ot={class:"bg-blue-50 rounded-lg p-3 text-center"},nt={class:"text-xl font-bold"},at={class:"bg-purple-50 rounded-lg p-3 text-center"},lt={class:"text-xl font-bold truncate"},rt={class:"bg-green-50 rounded-lg p-3 text-center"},it={class:"text-xl font-bold truncate"},dt={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 overflow-y-auto flex-1 pb-6"},ct=["onClick"],ut={class:"relative mb-2"},mt=["src","alt"],pt={key:0,class:"absolute bottom-0 left-0 right-0 text-center"},vt={key:1,class:"absolute top-0 left-0 text-center"},gt={class:"text-sm font-medium text-center mb-1 truncate w-full"},ft={key:2,class:"flex-1 flex flex-col items-center justify-center text-gray-500"},xt={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},_t={class:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-auto"},ht={class:"p-6"},yt={class:"flex justify-between items-start mb-4"},bt={class:"flex flex-col md:flex-row gap-6 mb-6"},kt={class:"flex-1 flex justify-center"},wt=["src","alt"],Ct={class:"flex-1"},It={class:"space-y-3"},$t={class:"font-medium"},jt={class:"font-medium"},Vt={class:"font-medium"},Ut={key:0,class:"border-t border-gray-200 pt-4 mb-4"},zt={class:"text-sm text-gray-600"},Bt={key:1,class:"border-t border-gray-200 pt-4 mb-4"},St={class:"text-sm text-blue-500 italic"},At={key:2,class:"grid grid-cols-2 gap-2"},Mt=["src","alt"],Ot={class:"text-xs mt-1 truncate"},Lt={class:"border-t border-gray-200 pt-4"},Wt={class:"text-sm text-gray-600"},Nt={class:"bg-gray-50 px-6 py-3 flex justify-end gap-3"},Rt=["href"],Ft={__name:"index",props:{id:{type:String,required:!1}},setup(ae){const q=ae,S=m([]);se(async()=>{try{const e=await(await fetch("https://doom-asthma-defendant-mechanism.trycloudflare.com/api/players")).json();e.success&&(S.value=e.players.map(n=>({id:n.id,name:n.name,avatar:n.avata,steamId:n.id64,inventoryCount:n.count??0,status:n.status??0,is_pro:n.is_pro??0,is_seller:n.is_reseller??0})))}catch(o){console.error("❌ 获取玩家列表失败:",o)}}),console.log(S.value);const x=m(""),le=m(null),p=m([]),A=m(0),re=m(""),M=m(!1),O=m(""),L=m(null),V=m(!1),r=m({}),b=m(""),k=m(""),U=m("default"),ie=m(["消费级","工业级","军规级","受限","保密","隐秘","非凡"]),de=m(["步枪","手枪","重型武器","匕首","手套","印花","音乐盒"]),h=["非凡","隐秘","保密","受限","军规级","工业级","消费级"],ce=w(()=>S.value.filter(o=>o.name.toLowerCase().includes(O.value.toLowerCase()))),W=w(()=>{let o=[...p.value];switch(b.value&&(o=o.filter(e=>e.rarity.name===b.value)),k.value&&(o=o.filter(e=>e.type.includes(k.value))),U.value){case"name-asc":o.sort((e,n)=>e.market_hash_name.localeCompare(n.market_hash_name));break;case"name-desc":o.sort((e,n)=>n.market_hash_name.localeCompare(e.market_hash_name));break;case"value-asc":o.sort((e,n)=>(e.price||0)-(n.price||0));break;case"value-desc":o.sort((e,n)=>(n.price||0)-(e.price||0));break;case"rarity-asc":o.sort((e,n)=>h.indexOf(e.rarity.name)-h.indexOf(n.rarity.name));break;case"rarity-desc":o.sort((e,n)=>h.indexOf(n.rarity.name)-h.indexOf(e.rarity.name));break}return o}),ue=w(()=>W.value.reduce((o,e)=>o+(e.price||0),0)),me=w(()=>p.value.length===0?null:[...p.value].sort((o,e)=>h.indexOf(e.rarity.name)-h.indexOf(o.rarity.name))[0]),pe=w(()=>p.value.length===0?null:[...p.value].sort((o,e)=>(e.price||0)-(o.price||0))[0]),ve=o=>{L.value=o,x.value=o.steamId,z()},z=async()=>{if(x.value){M.value=!0;try{const o=await $fetch(`https://doom-asthma-defendant-mechanism.trycloudflare.com/api/getInventory/${x.value}`),e=new Date,n=o!=null&&o.updated_at?new Date(o.updated_at):null,g=n&&e.getTime()-n.getTime()<24*60*60*1e3,_=o.data.inventory;if(o!=null&&o.success&&g&&_&&_!=="[]"){const i=Array.isArray(o.data.inventory)?o.data.inventory:[];p.value=i,A.value=i.length,re.value=o.updated_at,console.log("📦 使用缓存库存数据")}else{const i=await $fetch(`https://doom-asthma-defendant-mechanism.trycloudflare.com/api/inventory/${x.value}`);le.value=i;const s=xe(i);p.value=s,A.value=s.length,console.log("📦 使用接口数据");try{await $fetch(`https://doom-asthma-defendant-mechanism.trycloudflare.com/api/postInventory/${x.value}`,{method:"POST",headers:{"Content-Type":"application/json"},body:{inventory:s,count:s.length}})}catch(u){console.warn("⚠️ 上传库存失败（不影响展示）:",u)}}}catch(o){console.error("❌ 获取库存失败:",o),p.value=[],A.value=0}finally{M.value=!1}}},ge=()=>{x.value="",p.value=[],L.value=null,b.value="",k.value="",U.value="default"},fe=o=>{r.value=o,V.value=!0},xe=o=>{var e,n,g,_;return!((n=(e=o==null?void 0:o.data)==null?void 0:e.raw)!=null&&n.assets)||!((_=(g=o==null?void 0:o.data)==null?void 0:g.raw)!=null&&_.descriptions)?(console.error("无效的库存数据结构"),[]):o.data.raw.assets.map(i=>{var H,J,Q,X,Y,T,ee,te;const s=o.data.raw.descriptions.find(d=>d.classid===i.classid&&d.instanceid===i.instanceid);if(!s)return null;const u=(H=s.tags)==null?void 0:H.find(d=>d.category==="Rarity"),f=(J=s.tags)==null?void 0:J.find(d=>d.category==="Exterior"),N=(Q=s.tags)==null?void 0:Q.find(d=>d.category==="Weapon"),R=(X=s.tags)==null?void 0:X.find(d=>d.category==="Type"),D=(Y=s.tags)==null?void 0:Y.find(d=>d.category==="Tournament"),K=(T=s.descriptions)==null?void 0:T.find(d=>d.name==="exterior_wear"),ye=K?K.value.replace("外观: ",""):null,P=(ee=s.descriptions)==null?void 0:ee.find(d=>d.name==="nametag"),be=P?P.value:null,Z=(te=s.descriptions)==null?void 0:te.find(d=>d.name==="sticker_info");let G=[];return Z&&(G=[...Z.value.matchAll(/<img[^>]+src="([^"]+)"[^>]+title="印花: ([^"]+)"/g)].map(B=>({img:B[1].startsWith("http")?B[1]:`https://steamcdn-a.akamaihd.net${B[1]}`,name:B[2]}))),{id:`${i.assetid}-${i.classid}-${i.instanceid}`,assetid:i.assetid,classid:i.classid,instanceid:i.instanceid,appid:i.appid,name:s.market_name||s.name,market_hash_name:s.market_hash_name,type:(R==null?void 0:R.localized_tag_name)||s.type||"未知",icon_url:`https://steamcommunity-a.akamaihd.net/economy/image/${s.icon_url}`,rarity:{name:(u==null?void 0:u.localized_tag_name)||"普通",color:(u==null?void 0:u.color)||"#B0C3D9",internal_name:(u==null?void 0:u.internal_name)||""},exterior:{name:(f==null?void 0:f.localized_tag_name)||"",color:_e(f==null?void 0:f.internal_name),internal_name:(f==null?void 0:f.internal_name)||""},weapon:(N==null?void 0:N.localized_tag_name)||null,wear:ye,nametag:be,stickers:G,tournament:(D==null?void 0:D.localized_tag_name)||null,tradable:s.tradable===1,marketable:s.marketable===1,commodity:s.commodity===1,name_color:s.name_color||"#D2D2D2",description:he(s.descriptions),_raw:{asset:i,description:s}}}).filter(Boolean)},_e=o=>({WearCategory0:"#4b69ff",WearCategory1:"#5e98d9",WearCategory2:"#4b69ff",WearCategory3:"#eb4b4b",WearCategory4:"#8847ff"})[o]||"#B0C3D9",he=o=>{if(!o)return"暂无描述";const e=o.find(n=>{var g;return n.type==="html"&&n.value.trim()!==""&&!((g=n.name)!=null&&g.endsWith("_wear"))&&n.name!=="nametag"&&n.name!=="sticker_info"&&n.name!=="keychain_info"});return(e==null?void 0:e.value)||"暂无描述"};return se(()=>{q.id&&(x.value=q.id,z())}),(o,e)=>{var g,_,i;const n=ke;return l(),a("div",Be,[t("div",Se,[e[7]||(e[7]=t("div",{class:"text-xl font-bold mb-6 text-center py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg"}," CSGO 仓库查看器 ",-1)),t("div",Ae,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>O.value=s),placeholder:"搜索用户...",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-pink-500 focus:border-pink-500"},null,512),[[oe,O.value]])]),t("div",Me,[(l(!0),a(I,null,$(y(ce),s=>{var u;return l(),a("div",{key:s.id,onClick:f=>ve(s),class:je(["bg-gray-50 hover:bg-pink-50 cursor-pointer rounded-lg shadow flex flex-col items-center p-3 transition-all duration-200 border border-transparent hover:border-pink-200",{"bg-pink-100 border-pink-300":((u=L.value)==null?void 0:u.id)===s.id}])},[t("img",{src:s.avatar,alt:s.name,class:"w-14 h-14 rounded-full object-cover mb-2 border-2 border-white shadow"},null,8,Le),t("div",We,[t("span",null,c(s.name),1)]),t("div",Ne,[s.status===1?(l(),a("img",Re)):v("",!0),s.is_pro===1?(l(),a("img",De)):v("",!0),s.is_reseller?(l(),a("img",Ee)):v("",!0)]),t("span",Fe,"库存: "+c(s.inventoryCount||0),1)],10,Oe)}),128))])]),t("div",qe,[t("div",Ke,[t("div",Pe,[t("div",Ze,[C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),placeholder:"输入Steam64 ID 或社区URL",class:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-pink-500 focus:border-pink-500",onKeyup:we(z,["enter"])},null,544),[[oe,x.value]])]),t("div",Ge,[t("button",{onClick:z,class:"px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-md shadow-sm flex items-center gap-2 transition-colors"},[M.value?(l(),a("span",Je,e[8]||(e[8]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),ne(" 加载中... ")]))):(l(),a("span",He,"查询库存"))]),t("button",{onClick:ge,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md shadow-sm transition-colors"}," 重置 "),Ce(n,{to:"/addPlayers",class:"px-4 py-2 bg-red-200 hover:bg-gray-300 text-gray-800 rounded-md shadow-sm transition-colors inline-block text-center"},{default:Ie(()=>e[9]||(e[9]=[ne(" 添加库存账号 ")])),_:1,__:[9]})])]),t("div",Qe,[C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),class:"px-3 py-1 border border-gray-300 rounded-md text-sm"},[e[10]||(e[10]=t("option",{value:""},"全部稀有度",-1)),(l(!0),a(I,null,$(ie.value,s=>(l(),a("option",{key:s,value:s},c(s),9,Xe))),128))],512),[[E,b.value]]),C(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),class:"px-3 py-1 border border-gray-300 rounded-md text-sm"},[e[11]||(e[11]=t("option",{value:""},"全部类型",-1)),(l(!0),a(I,null,$(de.value,s=>(l(),a("option",{key:s,value:s},c(s),9,Ye))),128))],512),[[E,k.value]]),C(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),class:"px-3 py-1 border border-gray-300 rounded-md text-sm"},e[12]||(e[12]=[$e('<option value="default">默认排序</option><option value="name-asc">名称 (A-Z)</option><option value="name-desc">名称 (Z-A)</option><option value="value-asc">价格 (低到高)</option><option value="value-desc">价格 (高到低)</option><option value="rarity-asc">稀有度 (低到高)</option><option value="rarity-desc">稀有度 (高到低)</option>',7)]),512),[[E,U.value]])])]),p.value.length>0?(l(),a("div",Te,[t("div",et,[t("div",tt,[e[13]||(e[13]=t("div",{class:"text-sm text-pink-600 font-medium"},"总物品数",-1)),t("div",st,c(p.value.length),1)]),t("div",ot,[e[14]||(e[14]=t("div",{class:"text-sm text-blue-600 font-medium"},"预估总价值",-1)),t("div",nt,"¥ "+c(y(ue).toFixed(2)),1)]),t("div",at,[e[15]||(e[15]=t("div",{class:"text-sm text-purple-600 font-medium"},"最稀有物品",-1)),t("div",lt,c(((g=y(me))==null?void 0:g.market_hash_name)||"-"),1)]),t("div",rt,[e[16]||(e[16]=t("div",{class:"text-sm text-green-600 font-medium"},"最值钱物品",-1)),t("div",it,c(((_=y(pe))==null?void 0:_.market_hash_name)||"-"),1)])])])):v("",!0),y(W).length>0?(l(),a("div",dt,[(l(!0),a(I,null,$(y(W),s=>(l(),a("div",{key:s.id,onClick:u=>fe(s),class:"bg-white hover:shadow-lg rounded-lg shadow-md p-3 flex flex-col items-center cursor-pointer transition-all duration-200 transform hover:-translate-y-1 border border-gray-100"},[t("div",ut,[t("img",{src:s.icon_url||"https://via.placeholder.com/150",alt:s.market_hash_name,class:"w-20 h-20 object-contain"},null,8,mt),s.rarity?(l(),a("div",pt,[t("span",{class:"inline-block px-1 text-xs font-medium rounded",style:j({backgroundColor:"#"+s.rarity.color})},c(s.rarity.name),5)])):v("",!0),s.exterior.name?(l(),a("div",vt,[t("span",{class:"inline-block px-1 text-xs font-medium rounded",style:j({backgroundColor:s.exterior.color})},c(s.exterior.name),5)])):v("",!0)]),t("p",gt,c(s.name),1)],8,ct))),128))])):(l(),a("div",ft,e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),t("p",{class:"text-lg mb-2"},"没有找到库存物品网络问题或者是该用户的账号为私密状态",-1),t("p",{class:"text-sm"},"请输入SteamID或点击用户头像查询",-1)]))),V.value?(l(),a("div",xt,[t("div",_t,[t("div",ht,[t("div",yt,[t("h3",{class:"text-xl font-bold",style:j({color:r.value.name_color})},c(r.value.name),5),t("button",{onClick:e[5]||(e[5]=s=>V.value=!1),class:"text-gray-500 hover:text-gray-700"},e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",bt,[t("div",kt,[t("img",{src:r.value.icon_url,alt:r.value.market_hash_name,class:"w-40 h-40 object-contain border border-gray-200 rounded-lg"},null,8,wt)]),t("div",Ct,[t("div",It,[t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm text-gray-500"},"类型",-1)),t("p",$t,c(r.value.type||"未知"),1)]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm text-gray-500"},"稀有度",-1)),t("p",jt,[t("span",{class:"inline-block px-2 py-0.5 text-xs rounded",style:j({backgroundColor:r.value.rarity.color})},c(r.value.rarity.name||"未知"),5)])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm text-gray-500"},"外观",-1)),t("p",Vt,[t("span",{class:"inline-block px-2 py-0.5 text-xs rounded",style:j({backgroundColor:r.value.exterior.color})},c(r.value.exterior.name||"未知"),5)])])])])]),r.value.wear?(l(),a("div",Ut,[e[22]||(e[22]=t("h4",{class:"font-medium mb-2"},"磨损",-1)),t("p",zt,c(r.value.wear),1)])):v("",!0),r.value.nametag?(l(),a("div",Bt,[e[23]||(e[23]=t("h4",{class:"font-medium mb-2"},"名称标签",-1)),t("p",St,c(r.value.nametag),1)])):v("",!0),(i=r.value.stickers)!=null&&i.length?(l(),a("div",At,[(l(!0),a(I,null,$(r.value.stickers,(s,u)=>(l(),a("div",{key:u,class:"text-center"},[t("img",{src:s.img,alt:s.name,class:"w-16 h-12 object-contain mx-auto"},null,8,Mt),t("p",Ot,c(s.name),1)]))),128))])):v("",!0),t("div",Lt,[e[24]||(e[24]=t("h4",{class:"font-medium mb-2"},"物品描述",-1)),t("p",Wt,c(r.value.description||"暂无描述"),1)])]),t("div",Nt,[t("button",{onClick:e[6]||(e[6]=s=>V.value=!1),class:"px-4 py-2 text-gray-700 hover:text-gray-900"}," 关闭 "),r.value.market_hash_name?(l(),a("a",{key:0,href:`https://steamcommunity.com/market/listings/730/${encodeURIComponent(r.value.market_hash_name)}`,target:"_blank",class:"px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-md shadow-sm transition-colors"}," 查看市场 ",8,Rt)):v("",!0)])])])):v("",!0)])])}}};export{Ft as default};
